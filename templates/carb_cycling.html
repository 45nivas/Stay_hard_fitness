{% extends 'base.html' %}
{% block content %}
<div class="carb-cycling-container">
    <div class="page-header">
        <h1>üîÑ Carb Cycling Calculator</h1>
        <p>Advanced nutrition strategy for optimized body composition and performance</p>
    </div>

    <!-- Beginner Alert Banner -->
    <div class="alert alert-warning">
        <div class="alert-icon">‚ö†Ô∏è</div>
        <div class="alert-content">
            <strong>Beginner Alert:</strong> Carb cycling is generally for advanced lifters. Beginners may experience dizziness or fatigue; consult a professional.
        </div>
    </div>

    <div class="calculator-layout">
        <!-- Input Form -->
        <div class="calculator-form">
            <div class="form-header">
                <h2>Personal Information</h2>
                <p>Enter your details for personalized carb cycling plan</p>
            </div>

            <form method="post" class="carb-form">
                {% csrf_token %}
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="age">Age (years)</label>
                        <input type="number" id="age" name="age" min="18" max="80" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="gender">Gender</label>
                        <select id="gender" name="gender" required>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="height">Height</label>
                        <div class="input-with-unit">
                            <input type="number" id="height" name="height" step="0.1" min="120" max="250" required>
                            <select name="height_unit" class="unit-select">
                                <option value="cm">cm</option>
                                <option value="ft">ft</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="weight">Weight</label>
                        <div class="input-with-unit">
                            <input type="number" id="weight" name="weight" step="0.1" min="40" max="200" required>
                            <select name="weight_unit" class="unit-select">
                                <option value="kg">kg</option>
                                <option value="lbs">lbs</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="activity_level">Activity Level</label>
                        <select id="activity_level" name="activity_level" required>
                            <option value="sedentary">Sedentary (Desk job, little exercise)</option>
                            <option value="light">Light (Light exercise 1-3 days/week)</option>
                            <option value="moderate" selected>Moderate (Moderate exercise 3-5 days/week)</option>
                            <option value="active">Active (Hard exercise 6-7 days/week)</option>
                            <option value="very_active">Very Active (Physical job + exercise)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="training_days">Training Days/Week</label>
                        <input type="number" id="training_days" name="training_days" min="1" max="7" value="3" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="goal">Primary Goal</label>
                    <select id="goal" name="goal" required>
                        <option value="fat_loss">Fat Loss (15% calorie deficit)</option>
                        <option value="maintenance" selected>Maintenance (Steady weight)</option>
                        <option value="muscle_gain">Muscle Gain (10% calorie surplus)</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary btn-large">
                    Calculate Carb Cycling Plan
                </button>
            </form>
        </div>

        <!-- Results Display -->
        {% if result %}
        <div class="calculator-results">
            {% if result.error %}
                <div class="alert alert-error">
                    {{ result.error }}
                </div>
            {% else %}
                <div class="results-header">
                    <h2>Your Carb Cycling Plan</h2>
                    <p>Personalized macro and calorie distribution</p>
                </div>

                <!-- Basic Metrics -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">{{ result.bmr }}</div>
                        <div class="metric-label">BMR (Calories)</div>
                        <div class="metric-desc">Basal Metabolic Rate</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">{{ result.tdee }}</div>
                        <div class="metric-label">TDEE (Calories)</div>
                        <div class="metric-desc">Total Daily Energy</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">{{ result.protein_g }}g</div>
                        <div class="metric-label">Daily Protein</div>
                        <div class="metric-desc">Consistent every day</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">{{ result.fat_g }}g</div>
                        <div class="metric-label">Daily Fats</div>
                        <div class="metric-desc">25% of total calories</div>
                    </div>
                </div>

                <!-- Carb Cycling Days -->
                <div class="carb-days-section">
                    <h3>Carb Cycling Breakdown</h3>
                    <div class="carb-days-grid">
                        <div class="carb-day-card high-carb">
                            <div class="carb-day-type">High Carb Days</div>
                            <div class="carb-amount">{{ result.high_carb_g }}g carbs</div>
                            <div class="carb-calories">{{ result.high_carb_calories }} calories</div>
                            <div class="carb-note">Training days</div>
                        </div>
                        <div class="carb-day-card medium-carb">
                            <div class="carb-day-type">Medium Carb Days</div>
                            <div class="carb-amount">{{ result.medium_carb_g }}g carbs</div>
                            <div class="carb-calories">{{ result.medium_carb_calories }} calories</div>
                            <div class="carb-note">Light training</div>
                        </div>
                        <div class="carb-day-card low-carb">
                            <div class="carb-day-type">Low Carb Days</div>
                            <div class="carb-amount">{{ result.low_carb_g }}g carbs</div>
                            <div class="carb-calories">{{ result.low_carb_calories }} calories</div>
                            <div class="carb-note">Rest days</div>
                        </div>
                    </div>
                </div>

                <!-- Weekly Schedule -->
                <div class="weekly-schedule">
                    <h3>Suggested Weekly Plan</h3>
                    <p class="schedule-note">Match high-carb days to training days, low-carb on rest days</p>
                    <div class="schedule-grid">
                        {% for day in result.weekly_schedule %}
                        <div class="schedule-day {{ day.carb_type|lower }}-day">
                            <div class="day-name">{{ day.day }}</div>
                            <div class="day-carb-type">{{ day.carb_type }} Carb</div>
                            <div class="day-carbs">{{ day.carbs|floatformat:1 }}g</div>
                            <div class="day-calories">{{ day.calories }} cal</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Guidelines -->
                <div class="guidelines-section">
                    <h3>Implementation Guidelines</h3>
                    <div class="guidelines-grid">
                        <div class="guideline-card">
                            <div class="guideline-icon">üí™</div>
                            <h4>High Carb Days</h4>
                            <p>Consume on intense training days. Focus on complex carbs around workouts for optimal performance and recovery.</p>
                        </div>
                        <div class="guideline-card">
                            <div class="guideline-icon">‚öñÔ∏è</div>
                            <h4>Medium Carb Days</h4>
                            <p>Moderate training or active recovery days. Balanced approach to maintain energy while promoting fat utilization.</p>
                        </div>
                        <div class="guideline-card">
                            <div class="guideline-icon">üî•</div>
                            <h4>Low Carb Days</h4>
                            <p>Rest days or light activity. Promote fat burning while maintaining muscle mass with adequate protein.</p>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
